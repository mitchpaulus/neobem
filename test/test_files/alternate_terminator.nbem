to_coords = 位 list islast {
  terminator = if islast then ';' else ','
  return index(list, 0) + ',' + index(list, 1) + ',' + index(list, 2) + terminator + '  ! X, Y, Z {m}\n'
}

coords = [
  [1, 2, 3],
  [4, 5, 6],
]

all_coords = 位 coords {
  lines = map(init(coords), 位 list { to_coords(list, false) } ) + map([last(coords)], 位 list { to_coords(list, true) })
  return join(lines, '')
}

Version,
  <all_coords(coords)> $
